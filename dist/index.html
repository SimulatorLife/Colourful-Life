<!DOCTYPE html><html lang="en"><head><meta charset="utf-8"><meta name="viewport" content="width=device-width, initial-scale=1.0"><title>Colourful Life Simulation</title><style>canvas{background-color:#000;margin:0 auto;display:block}body{background-color:#222}</style></head><body> <button id="pauseButton">Pause</button> <div id="controls" style="color:#ddd;max-width:1000px;flex-wrap:wrap;align-items:center;gap:16px;margin:8px auto;font-family:sans-serif;display:flex"> <label>Society ≥ <span id="socVal">0.85</span> <input id="socSlider" type="range" min="0" max="1" step="0.01" value="0.85"> </label> <label>Enemy ≤ <span id="eneVal">0.50</span> <input id="eneSlider" type="range" min="0" max="1" step="0.01" value="0.50"> </label> <label>Event Strength × <span id="evtVal">1.0</span> <input id="evtSlider" type="range" min="0" max="3" step="0.05" value="1.0"> </label> </div> <canvas id="gameCanvas"></canvas> <script type="module">const t=document.getElementById("gameCanvas"),e=t.getContext("2d");t.width=1e3,t.height=1e3;const n=10,r=t.height/n,s=t.width/n;let a=50,i=0;const o=new class{constructor(t,e){this.rows=t,this.cols=e,this.eventCounter=0,this.currentEvent=this.generateRandomEvent()}generateRandomEvent(){const t=["flood","drought","heatwave","coldwave"],e=t[Math.floor(Math.random()*t.length)],n=Math.floor(501*Math.random())+100,r=Math.random();return{eventType:e,duration:n,affectedArea:{x:Math.floor(Math.random()*this.cols),y:Math.floor(Math.random()*this.rows),width:Math.floor(Math.random()*(this.cols/4))+1,height:Math.floor(Math.random()*(this.rows/4))+1},strength:r}}updateEvent(){this.currentEvent&&this.eventCounter%this.currentEvent.duration!=0||(this.currentEvent=this.generateRandomEvent(),this.eventCounter=0),this.eventCounter++}applyEventEffects(t,e,n){const r=this.currentEvent;r&&e>=r.affectedArea.y&&e<r.affectedArea.y+r.affectedArea.height&&n>=r.affectedArea.x&&n<r.affectedArea.x+r.affectedArea.width&&r.eventType}}(r,s),h={flood:"rgba(0, 0, 255, 0.5)",drought:"rgba(210, 180, 140, 0.5)",heatwave:"rgba(255, 140, 0, 0.5)",coldwave:"rgba(135, 206, 235, 0.5)"};let c=.85,d=.5,l=1;const u=document.getElementById("socSlider"),g=document.getElementById("eneSlider"),m=document.getElementById("evtSlider"),f=document.getElementById("socVal"),M=document.getElementById("eneVal"),y=document.getElementById("evtVal");u.addEventListener("input",(()=>{c=parseFloat(u.value),f.textContent=c.toFixed(2)})),g.addEventListener("input",(()=>{d=parseFloat(g.value),M.textContent=d.toFixed(2)})),m.addEventListener("input",(()=>{l=parseFloat(m.value),y.textContent=l.toFixed(2)})),function(){const t=document.getElementById("controls");if(!t)return;const e=document.createElement("label");e.innerHTML='Speed <span id="spdVal"></span> ups';const n=document.createElement("input");n.id="spdSlider",n.type="range",n.min="1",n.max="60",n.step="1",n.value=String(a),e.appendChild(n),t.appendChild(e);const r=e.querySelector("#spdVal");r.textContent=String(a),n.addEventListener("input",(()=>{a=parseInt(n.value,10)||1,r.textContent=String(a)}))}();class p{constructor(t,e,n){this.r=0|t,this.g=0|e,this.b=0|n}static random(){return new p(Math.floor(256*Math.random()),Math.floor(256*Math.random()),Math.floor(256*Math.random()))}toColor(){return`rgb(${this.r},${this.g},${this.b})`}seed(){return(this.r|this.g<<8|this.b<<16)>>>0}prng(){return t=this.seed(),function(){let e=t+=1831565813;return e=Math.imul(e^e>>>15,1|e),e^=e+Math.imul(e^e>>>7,61|e),((e^e>>>14)>>>0)/4294967296};var t}weights(){const t=this.prng(),e=[];for(let n=0;n<6;n++){const n=[];for(let e=0;e<5;e++)n.push(2*t()-1);e.push(n)}return e}movementGenes(){const t=this.prng();return{wandering:t(),pursuit:t(),cautious:t()}}interactionGenes(){const t=this.prng();return{avoid:t(),fight:t(),cooperate:t()}}reproductionProb(){const t=this.prng(),e=.2+this.g/255*.4;return Math.min(.8,Math.max(.05,e*(.9+.2*t())))}initialEnergy(t=5){const e=(this.r+this.g+this.b)/765;return Math.max(.5,Math.min(t,.5+e*(t-.5)))}lifespanBase(t=1e3){const e=this.prng(),n=.5+this.b/255*.5;return Math.round(t*(n*(.95+.1*e())))}floodResist(){return this.b/255}heatResist(){return this.r/255}droughtResist(){return this.g/255}coldResist(){return(this.g+this.b)/510}mutationChance(){return.08+.2*this.prng()()}mutationRange(){const t=this.prng();return 6+Math.floor(20*t())}starvationThresholdFrac(){return.8-this.g/255*.6}neurons(){const t=this.prng();return Math.max(1,Math.floor(5*t())+1)}sight(){const t=this.prng();return Math.max(1,Math.floor(5*t())+1)}baseEnergyLossScale(){return.5+(this.r+this.g+this.b)/765}strategy(){return this.prng()()}lifespanAdj(){return(this.b-127.5)/255*100}reproduceWith(t,e=.15,n=12){const r=(t,r)=>{let s=Math.round((t+r)/2);return Math.random()<e&&(s+=Math.floor((2*Math.random()-1)*n)),Math.max(0,Math.min(255,s))};return new p(r(this.r,t.r),r(this.g,t.g),r(this.b,t.b))}similarity(t){const e=this.r-t.r,n=this.g-t.g,r=this.b-t.b;return 1-Math.sqrt(e*e+n*n+r*r)/Math.sqrt(195075)}}class v{static baseEnergyLoss=.05;static chanceToMutate=.15;static geneMutationRange=.2;constructor(t,e,n,r){this.row=t,this.col=e,this.dna=n||p.random(),this.genes=this.dna.weights(),this.color=this.dna.toColor(),this.age=0;const s=this.dna.lifespanAdj();this.lifespan=Math.max(100,Math.min(2*v.maxAge,this.dna.lifespanBase(v.maxAge)+s)),this.sight=this.dna.sight(),this.energy=r??this.dna.initialEnergy(w.maxTileEnergy),this.neurons=this.dna.neurons(),this.strategy=this.dna.strategy(),this.movementGenes=this.dna.movementGenes(),this.interactionGenes=this.dna.interactionGenes()}static breed(t,e){const n=t.row,r=t.col,s=(t.dna.mutationChance()+e.dna.mutationChance())/2,a=Math.round((t.dna.mutationRange()+e.dna.mutationRange())/2),i=t.dna.reproduceWith(e.dna,s,a),o=(Math.max(1,Math.round((t.neurons+e.neurons)/2)),Math.max((t.energy+e.energy)/2,.5)),h=new v(n,r,i,o),c=(t.strategy+e.strategy)/2+(Math.random()*v.geneMutationRange-v.geneMutationRange/2);return h.strategy=Math.min(1,Math.max(0,c)),t.energy/=2,e.energy/=2,h}similarityTo(t){return this.dna.similarity(t.dna)}static computeLifespan(t){const e=t?.[0]?.[0]??0,n=Math.max(0,1+e);return Math.round(600*n+(r=0,s=600,Math.random()*(s-r)+r));var r,s}findBestMate(t){let e=null,n=-1/0;return t.forEach((t=>{const r=this.similarityTo(t.target);r>n&&(n=r,e=t)})),e}decide(t,e,n,r){const s=[1,t,e,n,r],a=this.genes.map((t=>t.reduce(((t,e,n)=>t+e*s[n]),0)));let i=a[0],o=0;for(let t=1;t<a.length;t++)a[t]>i&&(i=a[t],o=t);return o}decideMove(){const t=Math.floor(4*Math.random());return 0===t?{dr:-1,dc:0}:1===t?{dr:1,dc:0}:2===t?{dr:0,dc:-1}:{dr:0,dc:1}}manageEnergy(t,e){const n=function(t,e){const n={};for(let a=-1;a<=1;a++)for(let i=-1;i<=1;i++){if(0===a&&0===i)continue;const o=(t+i+r)%r,h=(e+a+s)%s,c=S.getCell(o,h),d=c?.color;d&&(n[d]=(n[d]||0)+1)}return n}(t,e),a=Object.values(n).reduce(((t,e)=>t+e),0)/8,i=this.genes?.[5],o=Array.isArray(i)?i.reduce(((t,e)=>t+Math.abs(e)),0)/(i.length||1):Math.abs(Number(i)||0),h=v.baseEnergyLoss*this.dna.baseEnergyLossScale()*(1+o)*(1+a);return this.energy-=h,this.energy<=this.starvationThreshold()}starvationThreshold(){return this.dna.starvationThresholdFrac()*w.maxTileEnergy}static randomMovementGenes(){return{wandering:Math.random(),pursuit:Math.random(),cautious:Math.random()}}chooseMovementStrategy(){const{wandering:t,pursuit:e,cautious:n}=this.movementGenes,r=t+e+n,s=Math.random()*r;return s<t?"wandering":s<t+e?"pursuit":"cautious"}executeMovementStrategy(t,e,n,r,s,a){const i=this.chooseMovementStrategy();if("pursuit"===i&&a.length>0){const r=a[Math.floor(Math.random()*a.length)];b(t,e,n,r.row,r.col)}else if("cautious"===i&&a.length>0){const r=a[Math.floor(Math.random()*a.length)];x(t,e,n,r.row,r.col)}else!function(t,e,n,r){const{dr:s,dc:a}=r.decideMove();E(t,e,n,s,a)}(t,e,n,this)}}class w{static maxTileEnergy=5;static energyRegenRate=.25;constructor(t,e){this.rows=t,this.cols=e,this.grid=Array.from({length:t},(()=>Array(e).fill(null))),this.energyGrid=Array.from({length:t},(()=>Array.from({length:e},(()=>w.maxTileEnergy/2)))),this.init()}init(){for(let t=0;t<this.rows;t++)for(let e=0;e<this.cols;e++)if(Math.random()<.05){const n=p.random();this.grid[t][e]=new v(t,e,n)}}consumeEnergy(t,e,n){const r=this.energyGrid[e][n],s=Math.min(1,r);this.energyGrid[e][n]-=s,t.energy=Math.min(w.maxTileEnergy,t.energy+s)}regenerateEnergyGrid(){for(let t=0;t<this.rows;t++)for(let e=0;e<this.cols;e++)this.energyGrid[t][e]=Math.min(w.maxTileEnergy,this.energyGrid[t][e]+w.energyRegenRate)}getCell(t,e){return this.grid[t][e]}setCell(t,e,n){this.grid[t][e]=n}draw(){for(let t=0;t<this.rows;t++)for(let r=0;r<this.cols;r++){const s=this.getCell(t,r);s?(e.fillStyle=s.color,e.fillRect(r*n,t*n,n,n)):e.clearRect(r*n,t*n,n,n)}o.currentEvent&&(e.fillStyle=h[o.currentEvent.eventType],e.fillRect(o.currentEvent.affectedArea.x*n,o.currentEvent.affectedArea.y*n,o.currentEvent.affectedArea.width*n,o.currentEvent.affectedArea.height*n))}update(){const t=this.calculatePopulationDensity(),e=Math.floor(this.rows*this.cols*.05);!function(t,e){if(t>=e)return;const n=[];for(let t=0;t<r;t++)for(let e=0;e<s;e++)S.getCell(t,e)||n.push({r:t,c:e});const a=Math.min(e-t,n.length);for(let t=0;t<a;t++){const t=Math.floor(Math.random()*n.length),{r:e,c:r}=n.splice(t,1)[0],s=p.random(),a=new v(e,r,s);S.setCell(e,r,a)}}(Math.floor(t*this.rows*this.cols),e);const n=t>.5+.2*Math.random();this.regenerateEnergyGrid(),o.updateEvent();const a=new WeakSet;for(let t=0;t<this.rows;t++)for(let e=0;e<this.cols;e++){const r=this.grid[t][e];if(!r||a.has(r))continue;if(a.add(r),r.age++,r.age>=r.lifespan){this.grid[t][e]=null;continue}if(R(r,t,e,o.currentEvent),this.consumeEnergy(r,t,e),r.manageEnergy(t,e),r.energy<=0){this.grid[t][e]=null;continue}const{mates:s,enemies:h,society:c}=this.findTargets(t,e,r,n);if(s.length>0){const n=r.findBestMate(s);if(n){b(this.grid,t,e,n.row,n.col);const s=(r.dna.reproductionProb()+n.target.dna.reproductionProb())/2;if(i=s,Math.random()<i&&r.energy>=.5&&n.target.energy>=.5){const s=v.breed(r,n.target);this.grid[t][e]=s}}}else if(h.length>0){const n=h[Math.floor(Math.random()*h.length)],{avoid:s,fight:a,cooperate:i}=r.interactionGenes,o=s+a+i,c=Math.random()*o;if(c<s)x(this.grid,t,e,n.row,n.col);else if(c<s+a){Math.max(Math.abs(n.row-t),Math.abs(n.col-e))<=1?A(this,t,e,n.row,n.col):b(this.grid,t,e,n.row,n.col)}else{Math.max(Math.abs(n.row-t),Math.abs(n.col-e))<=1?C(this,t,e,n.row,n.col):b(this.grid,t,e,n.row,n.col)}}else r.executeMovementStrategy(this.grid,t,e,s,h,c||[])}var i}calculatePopulationDensity(){let t=0;for(let e=0;e<this.rows;e++)for(let n=0;n<this.cols;n++)this.grid[e][n]&&t++;return t/(this.rows*this.cols)}findTargets(t,e,n,r=!1){const s=[],a=[],i=[];for(let o=-n.sight;o<=n.sight;o++)for(let h=-n.sight;h<=n.sight;h++){if(0===o&&0===h)continue;const l=(t+h+this.rows)%this.rows,u=(e+o+this.cols)%this.cols,g=this.grid[l][u];if(g){const t=n.similarityTo(g);t>=c?i.push({row:l,col:u,target:g}):r||t<=d?a.push({row:l,col:u,target:g}):s.push({row:l,col:u,target:g})}}return{mates:s,enemies:a,society:i}}}function E(t,e,n,a,i){const o=(e+a+r)%r,h=(n+i+s)%s;return!t[o][h]&&(t[o][h]=t[e][n],t[e][n]=null,!0)}function b(t,e,n,r,s){const a=r-e,i=s-n;let o=0,h=0;return Math.abs(a)>=Math.abs(i)?o=Math.sign(a):h=Math.sign(i),E(t,e,n,o,h)}function x(t,e,n,r,s){const a=r-e,i=s-n;let o=0,h=0;return Math.abs(a)>=Math.abs(i)?o=-Math.sign(a):h=-Math.sign(i),E(t,e,n,o,h)}function A(t,e,n,r,s){const a=t.grid[e][n],i=t.grid[r][s];i&&(a.energy>=i.energy?(t.grid[r][s]=a,t.grid[e][n]=null,t.consumeEnergy(a,r,s)):t.grid[e][n]=null)}function C(t,e,n,r,s){const a=t.grid[e][n],i=t.grid[r][s];if(!i)return;const o=Math.min(1,a.energy/2);a.energy-=o,i.energy=Math.min(w.maxTileEnergy,i.energy+o)}function R(t,e,n,r){if(r&&e>=r.affectedArea.y&&e<r.affectedArea.y+r.affectedArea.height&&n>=r.affectedArea.x&&n<r.affectedArea.x+r.affectedArea.width){const e=r.strength*l;switch(r.eventType){case"flood":{const n=t.dna.floodResist();t.energy-=.3*e*(1-n);break}case"drought":{const n=t.dna.droughtResist();t.energy-=.25*e*(1-n);break}case"heatwave":{const n=t.dna.heatResist();t.energy-=.35*e*(1-n);break}case"coldwave":{const n=t.dna.coldResist();t.energy-=.2*e*(1-n);break}}t.energy=Math.max(0,Math.min(w.maxTileEnergy,t.energy))}}function T(){if(B.isPaused())return;const t=performance.now(),e=1e3/Math.max(1,a);t-i>=e&&(i=t,S.update()),S.draw(),requestAnimationFrame(T)}const S=new w(r,s),B=new class{constructor(t){this.pauseButton=document.getElementById("pauseButton"),this.paused=!1,this.updateCallback=t,this.pauseButton.addEventListener("click",(()=>this.togglePause())),document.addEventListener("keydown",(t=>{"p"!==t.key&&"P"!==t.key||this.togglePause()}))}togglePause(){this.paused=!this.paused,this.pauseButton.textContent=this.paused?"Resume":"Pause",this.paused||requestAnimationFrame(this.updateCallback)}isPaused(){return this.paused}}(T);requestAnimationFrame(T);</script> </body></html>